{"cells":[{"cell_type":"code","execution_count":null,"metadata":{"id":"roerKMqoL1wH"},"outputs":[],"source":["import numpy as np\n","import tensorflow as tf\n","import os\n","import fastai\n","from fastai.tabular.all import *\n","from fastai.text.all import *\n","from fastai.vision.all import *\n","from fastai import *\n","\n","from fastai.vision import *\n","\n","%reload_ext autoreload\n","%autoreload 2\n","\n","# ensure that any charts or images displayed are shown in this notebook\n","%matplotlib inline\n","from google.colab import files\n","import os\n","\n","\n","# to avoid warning of PyTorch\n","import warnings\n","warnings.filterwarnings(\"ignore\", category=UserWarning, module=\"torch.nn.functional\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"yG6doBY-L353"},"outputs":[],"source":["from google.colab import drive\n","from google.colab import files\n","files.upload()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"us7sh12oL5RE"},"outputs":[],"source":["!ls -lha kaggle.json\n","!pip install -q kaggle\n","\n","!mkdir -p ~/.kaggle\n","!cp kaggle.json ~/.kaggle/\n","!chmod 600 /root/.kaggle/kaggle.json\n","!pwd"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"jCAmq4BxL7CN"},"outputs":[],"source":["!kaggle datasets download -d wwymak/architecture-dataset\n","!unzip architecture-dataset.zip"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"zfYoF-MxMRTe"},"outputs":[],"source":["np.random.seed(42)\n","tfms = aug_transforms(do_flip=True, flip_vert=False, max_rotate=10, max_zoom=1.1, \n","                      max_lighting=0.2, max_warp=0.2, p_affine=0.75, p_lighting=0.75)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"_2ZxB8MMMSsc"},"outputs":[],"source":["batch_tfms = [IntToFloatTensor(), Normalize.from_stats(*imagenet_stats)]\n","data = ImageDataLoaders.from_folder('/content/arcDataset/', train=\".\", valid_pct=0.2, item_tfms=Resize(299), ds_tfms=batch_tfms, size=224, num_workers=4, padding_mode='reflection', bs=64)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"BxuAgM1bMpna"},"outputs":[],"source":["data.show_batch()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"cZJ0SpSANiI3"},"outputs":[],"source":["learn = vision_learner(data, models.resnet50, metrics=[accuracy, error_rate]).to_fp16()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"bZiQ_YFONiwy"},"outputs":[],"source":["learn.fit_one_cycle(10)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"fWBE78LMNlfS"},"outputs":[],"source":["learn.save('stage-1-resnet50')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"m7evXknxNl2A"},"outputs":[],"source":["interp = ClassificationInterpretation.from_learner(learn)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"V7AkVsxWNnGP"},"outputs":[],"source":["interp.most_confused(min_val=5)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"-MQCYP9FNoDz"},"outputs":[],"source":["interp.plot_top_losses(4, figsize=(15,11))"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"lseDAVrQNps5"},"outputs":[],"source":["interp.plot_confusion_matrix(figsize=(12,12), dpi=60)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"lT3Gu3kANqqx"},"outputs":[],"source":["learn.unfreeze()"]},{"cell_type":"code","source":["learn.lr_find()\n","learn.recorder.plot_lr_find()"],"metadata":{"id":"UNg-USTOrviQ"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["learn.fit_one_cycle(10, lr_max=slice(1e-5,1e-4))"],"metadata":{"id":"S8C1X-4a3lSr"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["learn.save('stage-2-resnet50')"],"metadata":{"id":"Xk5r94zV3sqy"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["interp = ClassificationInterpretation.from_learner(learn)"],"metadata":{"id":"HXhg0yTB4qis"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["interp.most_confused(min_val=5)"],"metadata":{"id":"f16-vlid4yt3"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["interp.plot_top_losses(4, figsize=(15,11))"],"metadata":{"id":"1jB13lJ67BSo"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["interp.plot_confusion_matrix(figsize=(12,12), dpi=60)"],"metadata":{"id":"QNq7mna-43Wc"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["learn.lr_find()\n","learn.recorder.plot_lr_find()"],"metadata":{"id":"pK3-CWCr57dW"},"execution_count":null,"outputs":[]}],"metadata":{"colab":{"provenance":[],"gpuType":"T4","authorship_tag":"ABX9TyNtEX1eTssR0jMAgE1nRw9P"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"},"accelerator":"GPU","gpuClass":"standard"},"nbformat":4,"nbformat_minor":0}